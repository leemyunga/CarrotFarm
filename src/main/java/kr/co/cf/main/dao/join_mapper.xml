<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC   "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.cf.main.dao.JoinDAO">
	
<select id="idChk" resultType="int">
      SELECT COUNT(userId) FROM user WHERE userId = #{param1}
   </select>
   
   <select id="nickChk" resultType="int">
      SELECT COUNT(nickName) FROM user WHERE nickName = #{param1}
   </select>
   
   <insert id="join" parameterType="kr.co.cf.main.dto.JoinDTO">
      INSERT INTO user(userId,nickName,userPw,userName,birthday,email,userBlind) 
         VALUES(#{userId},#{nickName},#{userPw},#{userName},#{birthday},#{email},false)
   </insert>
   
   <insert id="joinData" parameterType="kr.co.cf.main.dto.JoinDTO">
      INSERT INTO userData(userId,height,position,locationIdx,favTime) 
         VALUES(#{userId},#{height},#{position},#{locationIdx},#{favTime})
   </insert>

	<insert id="photoWrite" parameterType="String">
      INSERT INTO photo(categoryId,photoName,photoId) 
      VALUES((select categoryId from category where categoryKind = 'ProFile'),#{param1},'userProfile')
   	</insert>
   	
   	<select id="locationFind" resultType="int">
      SELECT locationIdx FROM location WHERE gu = #{param1}
   </select>
   
   <select id="login" resultType="kr.co.cf.main.dto.JoinDTO">
		SELECT nickName FROM user WHERE
			userId = #{param1} AND userPw = #{param2} AND userBlind = false	
	</select>
	
	<select id="findId" resultType="kr.co.cf.main.dto.JoinDTO">
		select * from user where EMAIL = #{email}
	</select>
	
	<select id="findIdCheck" resultType="int">
		select count(*) from user where Email = #{memberEmail}
	</select>
	
	<!-- 비밀번호 변경 -->
	<update id="updatePw" >
		update user set userPw = #{pw} where userId = #{id}
	</update>
	
	<!-- 유저 블라인드 -->
	<update id="userdelete">
      UPDATE user SET userBlind = true  WHERE nickName = #{param1}
   </update>
   
   <!-- 회원 정보 -->
   <select id="userInfo" resultType="kr.co.cf.main.dto.JoinDTO">
		SELECT u.userId, u.nickName, u.userPw, u.userName, u.birthday, u.email,
		d.height, d.position, d.favTime, l.si, l.gu 
		FROM user u JOIN userData d ON u.userId = d.userId JOIN location l ON d.locationIdx = l.locationIdx
		WHERE u.nickName = #{param1} AND u.userBlind = false;
	</select>
	
	<!-- 회원정보 수정 -->
	<update id="userInfoUpdate" parameterType="hashmap">
		UPDATE user SET nickName = #{nickName}
			,userPw = #{userPw}
			,email = #{email}
		WHERE userId = #{userId}
	</update>
	
	<update id="userInfoUpdatedata" parameterType="hashmap">
		UPDATE userData SET height = #{height}
			,position = #{position}
			,favTime = #{favTime}
		WHERE userId = #{userId}
	</update>
	
	<update id="userInfoUpdateloc">
		UPDATE userData SET locationIdx = #{param1}
		WHERE userId = #{param2}
	</update>

	
</mapper>